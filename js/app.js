(function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()({1:[function(require,module,exports){
'use strict';

var _component = require('./libs/component');

var _component2 = _interopRequireDefault(_component);

function _interopRequireDefault(obj) {
	return obj && obj.__esModule ? obj : { default: obj };
}

var onDOMContentLoadedTasks = [function () {
	var toggle = _component2.default.init('.js-toggle', { closeOnBlur: true });
	var localToggle = _component2.default.init('.js-toggle__local', { local: true });
	console.log(toggle);
}];

if ('addEventListener' in window) window.addEventListener('DOMContentLoaded', function () {
	onDOMContentLoadedTasks.forEach(function (fn) {
		return fn();
	});
});

},{"./libs/component":2}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _defaults = require('./lib/defaults');

var _defaults2 = _interopRequireDefault(_defaults);

var _componentPrototype = require('./lib/component-prototype');

var _componentPrototype2 = _interopRequireDefault(_componentPrototype);

function _interopRequireDefault(obj) {
	return obj && obj.__esModule ? obj : { default: obj };
}

var init = function init(sel, opts) {
	var els = [].slice.call(document.querySelectorAll(sel));

	if (els.length === 0) throw new Error('Toggle cannot be initialised, no trigger elements found');

	return els.map(function (el) {
		return Object.assign(Object.create(_componentPrototype2.default), {
			node: el,
			settings: Object.assign({}, _defaults2.default, el.dataset, opts)
		}).init();
	});
};

exports.default = { init: init };

},{"./lib/component-prototype":3,"./lib/defaults":4}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
var TRIGGER_EVENTS = ['click', 'keydown'],
    TRIGGER_KEYCODES = [13, 32],
    FOCUSABLE_ELEMENTS = ['a[href]', 'area[href]', 'input:not([disabled])', 'select:not([disabled])', 'textarea:not([disabled])', 'button:not([disabled])', 'iframe', 'object', 'embed', '[contenteditable]', '[tabindex]:not([tabindex="-1"])'];

exports.default = {
	init: function init() {
		this.toggles = this.node.getAttribute('data-toggle') && [].slice.call(document.querySelectorAll('.' + this.node.getAttribute('data-toggle')));
		if (!this.toggles) return console.warn('Toggle cannot be initialised, no toggle buttons elements found'), false;

		this.isOpen = false;
		if (this.settings.focus) this.focusableChildren = this.getFocusableChildren();
		if (this.settings.trapTab) this.boundKeyListener = this.keyListener.bind(this);
		if (this.settings.closeOnBlur) this.boundFocusInListener = this.focusInListener.bind(this);
		this.classTarget = !this.settings.local ? document.documentElement : this.node.parentNode;
		this.statusClass = !this.settings.local ? 'on--' + this.node.getAttribute('id') : 'active';
		this.animatingClass = !this.settings.local ? 'animating--' + this.node.getAttribute('id') : 'animating';

		this.initToggles();
		this.settings.startOpen && this.toggle();

		return this;
	},
	initToggles: function initToggles() {
		var _this = this;

		this.toggles.forEach(function (toggle) {
			toggle.setAttribute('role', 'button');
			toggle.setAttribute('aria-controls', _this.node.getAttribute('id'));
			toggle.setAttribute('aria-expanded', 'false');
			TRIGGER_EVENTS.forEach(function (ev) {
				toggle.addEventListener(ev, function (e) {
					if (!!e.keyCode && !~TRIGGER_KEYCODES.indexOf(e.keyCode)) return;
					e.preventDefault();
					_this.toggle();
				});
			});
		});
	},
	getFocusableChildren: function getFocusableChildren() {
		return [].slice.call(this.node.querySelectorAll(FOCUSABLE_ELEMENTS.join(',')));
	},

	toggleAttributes: function toggleAttributes() {
		this.isOpen = !this.isOpen;
		this.toggles.forEach(function (toggle) {
			toggle.setAttribute('aria-expanded', toggle.getAttribute('aria-expanded') === 'true' ? 'false' : 'true');
		});
	},
	toggleState: function toggleState() {
		this.classTarget.classList.remove(this.animatingClass);
		this.classTarget.classList.toggle(this.statusClass);
	},
	manageFocus: function manageFocus() {
		var _this2 = this;

		if (!this.isOpen) {
			this.lastFocused = document.activeElement;
			this.focusableChildren.length && window.setTimeout(function () {
				return _this2.focusableChildren[0].focus();
			}, this.settings.delay);
			this.settings.trapTab && document.addEventListener('keydown', this.boundKeyListener);
		} else {
			this.settings.trapTab && document.removeEventListener('keydown', this.boundKeyListener);
			this.focusableChildren.length && window.setTimeout(function () {
				_this2.lastFocused.focus();
				_this2.lastFocused = false;
			}, this.settings.delay);
		}
	},
	trapTab: function trapTab(e) {
		var focusedIndex = this.focusableChildren.indexOf(document.activeElement);
		if (e.shiftKey && focusedIndex === 0) {
			e.preventDefault();
			this.focusableChildren[this.focusableChildren.length - 1].focus();
		} else {
			if (!e.shiftKey && focusedIndex === this.focusableChildren.length - 1) {
				e.preventDefault();
				this.focusableChildren[0].focus();
			}
		}
	},
	keyListener: function keyListener(e) {
		if (this.isOpen && e.keyCode === 27) {
			e.preventDefault();
			this.toggle();
		}
		if (this.isOpen && e.keyCode === 9) this.trapTab(e);
	},

	focusInListener: function focusInListener(e) {
		if (!this.node.contains(e.target) && !this.toggles.reduce(function (acc, toggle) {
			if (toggle === e.target) acc = true;
			return acc;
		}, false)) this.toggle();
	},
	manageBlurClose: function manageBlurClose() {
		if (!this.isOpen) document.addEventListener('focusin', this.boundFocusInListener);else document.removeEventListener('focusin', this.boundFocusInListener);
	},
	toggle: function toggle(e) {
		var _this3 = this;

		var delay = this.classTarget.classList.contains(this.statusClass) ? this.settings.delay : 0;

		!!this.settings.prehook && typeof this.settings.prehook === 'function' && this.settings.prehook.call(this);

		if (e) e.preventDefault(), e.stopPropagation();

		this.classTarget.classList.add(this.animatingClass);

		window.setTimeout(function () {
			!!_this3.settings.focus && _this3.focusableChildren && _this3.manageFocus();
			!!_this3.settings.closeOnBlur && _this3.manageBlurClose();
			_this3.toggleAttributes();
			_this3.toggleState();
			!!_this3.settings.callback && typeof _this3.settings.callback === 'function' && _this3.settings.callback.call(_this3);
		}, delay);
	}
};

},{}],4:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.default = {
	delay: 0,
	startOpen: false,
	local: false,
	prehook: false,
	callback: false,
	focus: false,
	trapTab: false,
	closeOnBlur: false
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJleGFtcGxlL3NyYy9hcHAuanMiLCJleGFtcGxlL3NyYy9saWJzL2NvbXBvbmVudC9pbmRleC5qcyIsImV4YW1wbGUvc3JjL2xpYnMvY29tcG9uZW50L2xpYi9jb21wb25lbnQtcHJvdG90eXBlLmpzIiwiZXhhbXBsZS9zcmMvbGlicy9jb21wb25lbnQvbGliL2RlZmF1bHRzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQTs7Ozs7Ozs7QUFFQSxJQUFNLDJCQUEyQixZQUFNLEFBQ3RDO0tBQUksU0FBUyxvQkFBQSxBQUFPLEtBQVAsQUFBWSxjQUFjLEVBQUUsYUFBekMsQUFBYSxBQUEwQixBQUFlLEFBQ3REO0tBQUksY0FBYyxvQkFBQSxBQUFPLEtBQVAsQUFBWSxxQkFBcUIsRUFBRSxPQUFyRCxBQUFrQixBQUFpQyxBQUFTLEFBQzVEO1NBQUEsQUFBUSxJQUFSLEFBQVksQUFDWjtBQUpELEFBQWdDLENBQUE7O0FBTWhDLElBQUcsc0JBQUgsQUFBeUIsZUFBUSxBQUFPLGlCQUFQLEFBQXdCLG9CQUFvQixZQUFNLEFBQUU7eUJBQUEsQUFBd0IsUUFBUSxjQUFBO1NBQUEsQUFBTTtBQUF0QyxBQUE4QztBQUFsRyxDQUFBOzs7Ozs7Ozs7QUNSakM7Ozs7QUFDQTs7Ozs7Ozs7QUFFQSxJQUFNLE9BQU8sU0FBUCxBQUFPLEtBQUEsQUFBQyxLQUFELEFBQU0sTUFBUyxBQUMzQjtLQUFJLE1BQU0sR0FBQSxBQUFHLE1BQUgsQUFBUyxLQUFLLFNBQUEsQUFBUyxpQkFBakMsQUFBVSxBQUFjLEFBQTBCLEFBRWxEOztLQUFHLElBQUEsQUFBSSxXQUFQLEFBQWtCLEdBQUcsTUFBTSxJQUFBLEFBQUksTUFBVixBQUFNLEFBQVUsQUFFckM7O1lBQU8sQUFBSSxJQUFJLGNBQUE7Z0JBQU0sQUFBTyxPQUFPLE9BQUEsQUFBTyw0QkFBckI7U0FBaUQsQUFDOUQsQUFDTjthQUFVLE9B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Ozs7Ozs7OztRQ0xjLEFBQ1AsQUFDUDtZQUZjLEFBRUgsQUFDWDtRQUhjLEFBR1AsQUFDUDtVQUpjLEFBSUwsQUFDVDtXQUxjLEFBS0osQUFDVjtRQU5jLEFBTVAsQUFDUDtVQVBjLEFBT0wsQUFDVDtjLEFBUmMsQUFRRDtBQVJDLEFBQ2QiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfXJldHVybiBlfSkoKSIsImltcG9ydCBUb2dnbGUgZnJvbSAnLi9saWJzL2NvbXBvbmVudCc7XG5cbmNvbnN0IG9uRE9NQ29udGVudExvYWRlZFRhc2tzID0gWygpID0+IHtcblx0bGV0IHRvZ2dsZSA9IFRvZ2dsZS5pbml0KCcuanMtdG9nZ2xlJywgeyBjbG9zZU9uQmx1cjogdHJ1ZX0pO1xuXHRsZXQgbG9jYWxUb2dnbGUgPSBUb2dnbGUuaW5pdCgnLmpzLXRvZ2dsZV9fbG9jYWwnLCB7IGxvY2FsOiB0cnVlIH0pO1xuXHRjb25zb2xlLmxvZyh0b2dnbGUpO1xufV07XG4gICAgXG5pZignYWRkRXZlbnRMaXN0ZW5lcicgaW4gd2luZG93KSB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsgb25ET01Db250ZW50TG9hZGVkVGFza3MuZm9yRWFjaChmbiA9PiBmbigpKTsgfSk7XG4iLCJpbXBvcnQgZGVmYXVsdHMgZnJvbSAnLi9saWIvZGVmYXVsdHMnO1xuaW1wb3J0IGNvbXBvbmVudFByb3RvdHlwZSBmcm9tICcuL2xpYi9jb21wb25lbnQtcHJvdG90eXBlJztcblxuY29uc3QgaW5pdCA9IChzZWwsIG9wdHMpID0+IHtcblx0bGV0IGVscyA9IFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWwpKTtcblx0XG5cdGlmKGVscy5sZW5ndGggPT09IDApIHRocm93IG5ldyBFcnJvcignVG9nZ2xlIGNhbm5vdCBiZSBpbml0aWFsaXNlZCwgbm8gdHJpZ2dlciBlbGVtZW50cyBmb3VuZCcpO1xuXHRcblx0cmV0dXJuIGVscy5tYXAoZWwgPT4gT2JqZWN0LmFzc2lnbihPYmplY3QuY3JlYXRlKGNvbXBvbmVudFByb3RvdHlwZSksIHtcblx0XHRcdG5vZGU6IGVsLFxuXHRcdFx0c2V0dGluZ3M6IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRzLCBlbC5kYXRhc2V0LCBvcHRzKVxuXHRcdH0pLmluaXQoKSk7XG59O1xuICAgIFxuZXhwb3J0IGRlZmF1bHQgeyBpbml0IH07IiwiY29uc3QgVFJJR0dFUl9FVkVOVFMgPSBbJ2NsaWNrJywgJ2tleWRvd24nXSxcbiAgICAgIFRSSUdHRVJfS0VZQ09ERVMgPSBbMTMsIDMyXSxcblx0ICBGT0NVU0FCTEVfRUxFTUVOVFMgPSBbJ2FbaHJlZl0nLCAnYXJlYVtocmVmXScsICdpbnB1dDpub3QoW2Rpc2FibGVkXSknLCAnc2VsZWN0Om5vdChbZGlzYWJsZWRdKScsICd0ZXh0YXJlYTpub3QoW2Rpc2FibGVkXSknLCAnYnV0dG9uOm5vdChbZGlzYWJsZWRdKScsICdpZnJhbWUnLCAnb2JqZWN0JywgJ2VtYmVkJywgJ1tjb250ZW50ZWRpdGFibGVdJywgJ1t0YWJpbmRleF06bm90KFt0YWJpbmRleD1cIi0xXCJdKSddO1xuXG5leHBvcnQgZGVmYXVsdCB7XG5cdGluaXQoKSB7XG5cdFx0dGhpcy50b2dnbGVzID0gdGhpcy5ub2RlLmdldEF0dHJpYnV0ZSgnZGF0YS10b2dnbGUnKSAmJiBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgdGhpcy5ub2RlLmdldEF0dHJpYnV0ZSgnZGF0YS10b2dnbGUnKSkpO1xuXHRcdGlmKCF0aGlzLnRvZ2dsZXMpIHJldHVybiBjb25zb2xlLndhcm4oJ1RvZ2dsZSBjYW5ub3QgYmUgaW5pdGlhbGlzZWQsIG5vIHRvZ2dsZSBidXR0b25zIGVsZW1lbnRzIGZvdW5kJyksIGZhbHNlO1xuXHRcdFxuXHRcdHRoaXMuaXNPcGVuID0gZmFsc2U7XG5cdFx0aWYodGhpcy5zZXR0aW5ncy5mb2N1cykgdGhpcy5mb2N1c2FibGVDaGlsZHJlbiA9IHRoaXMuZ2V0Rm9jdXNhYmxlQ2hpbGRyZW4oKTtcblx0XHRpZih0aGlzLnNldHRpbmdzLnRyYXBUYWIpIHRoaXMuYm91bmRLZXlMaXN0ZW5lciA9IHRoaXMua2V5TGlzdGVuZXIuYmluZCh0aGlzKTtcblx0XHRpZih0aGlzLnNldHRpbmdzLmNsb3NlT25CbHVyKSB0aGlzLmJvdW5kRm9jdXNJbkxpc3RlbmVyID0gdGhpcy5mb2N1c0luTGlzdGVuZXIuYmluZCh0aGlzKTtcblx0XHR0aGlzLmNsYXNzVGFyZ2V0ID0gKCF0aGlzLnNldHRpbmdzLmxvY2FsKSA/IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCA6IHRoaXMubm9kZS5wYXJlbnROb2RlO1xuXHRcdHRoaXMuc3RhdHVzQ2xhc3MgPSAhdGhpcy5zZXR0aW5ncy5sb2NhbCA/IGBvbi0tJHt0aGlzLm5vZGUuZ2V0QXR0cmlidXRlKCdpZCcpfWAgOiAnYWN0aXZlJztcblx0XHR0aGlzLmFuaW1hdGluZ0NsYXNzID0gIXRoaXMuc2V0dGluZ3MubG9jYWwgPyBgYW5pbWF0aW5nLS0ke3RoaXMubm9kZS5nZXRBdHRyaWJ1dGUoJ2lkJyl9YCA6ICdhbmltYXRpbmcnO1xuXG5cdFx0dGhpcy5pbml0VG9nZ2xlcygpO1xuXHRcdHRoaXMuc2V0dGluZ3Muc3RhcnRPcGVuICYmIHRoaXMudG9nZ2xlKCk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fSxcblx0aW5pdFRvZ2dsZXMoKSB7XG5cdFx0dGhpcy50b2dnbGVzLmZvckVhY2godG9nZ2xlID0+IHtcblx0XHRcdHRvZ2dsZS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XG5cdFx0XHR0b2dnbGUuc2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJywgdGhpcy5ub2RlLmdldEF0dHJpYnV0ZSgnaWQnKSk7XG5cdFx0XHR0b2dnbGUuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyk7XG5cdFx0XHRUUklHR0VSX0VWRU5UUy5mb3JFYWNoKGV2ID0+IHtcblx0XHRcdFx0dG9nZ2xlLmFkZEV2ZW50TGlzdGVuZXIoZXYsIGUgPT4ge1xuXHRcdFx0XHRcdGlmKCEhZS5rZXlDb2RlICYmICF+VFJJR0dFUl9LRVlDT0RFUy5pbmRleE9mKGUua2V5Q29kZSkpIHJldHVybjtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0dGhpcy50b2dnbGUoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fSxcblx0Z2V0Rm9jdXNhYmxlQ2hpbGRyZW4oKSB7XG5cdFx0cmV0dXJuIFtdLnNsaWNlLmNhbGwodGhpcy5ub2RlLnF1ZXJ5U2VsZWN0b3JBbGwoRk9DVVNBQkxFX0VMRU1FTlRTLmpvaW4oJywnKSkpO1xuXHR9LFxuXHR0b2dnbGVBdHRyaWJ1dGVzOiBmdW5jdGlvbigpe1xuXHRcdHRoaXMuaXNPcGVuID0gIXRoaXMuaXNPcGVuO1xuXHRcdHRoaXMudG9nZ2xlcy5mb3JFYWNoKHRvZ2dsZSA9PiB7XG5cdFx0XHR0b2dnbGUuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgdG9nZ2xlLmdldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcpID09PSAndHJ1ZScgPyAnZmFsc2UnIDogJ3RydWUnKTtcblx0XHR9KTtcblx0fSxcblx0dG9nZ2xlU3RhdGU6IGZ1bmN0aW9uKCl7XG5cdFx0dGhpcy5jbGFzc1RhcmdldC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuYW5pbWF0aW5nQ2xhc3MpO1xuXHRcdHRoaXMuY2xhc3NUYXJnZXQuY2xhc3NMaXN0LnRvZ2dsZSh0aGlzLnN0YXR1c0NsYXNzKTtcblx0fSxcblx0bWFuYWdlRm9jdXM6IGZ1bmN0aW9uKCl7XG5cdFx0aWYoIXRoaXMuaXNPcGVuKXtcblx0XHRcdHRoaXMubGFzdEZvY3VzZWQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuXHRcdFx0dGhpcy5mb2N1c2FibGVDaGlsZHJlbi5sZW5ndGggJiYgd2luZG93LnNldFRpbWVvdXQoKCkgPT4gdGhpcy5mb2N1c2FibGVDaGlsZHJlblswXS5mb2N1cygpLCB0aGlzLnNldHRpbmdzLmRlbGF5KTtcblx0XHRcdHRoaXMuc2V0dGluZ3MudHJhcFRhYiAmJiBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5ib3VuZEtleUxpc3RlbmVyKTtcblx0XHR9XG5cdFx0ZWxzZSB7XG5cdFx0XHR0aGlzLnNldHRpbmdzLnRyYXBUYWIgJiYgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuYm91bmRLZXlMaXN0ZW5lcik7XG5cdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuLmxlbmd0aCAmJiB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdHRoaXMubGFzdEZvY3VzZWQuZm9jdXMoKTtcblx0XHRcdFx0dGhpcy5sYXN0Rm9jdXNlZCA9IGZhbHNlO1xuXHRcdFx0fSwgdGhpcy5zZXR0aW5ncy5kZWxheSk7XG5cdFx0fVxuXHR9LFxuXHR0cmFwVGFiOiBmdW5jdGlvbihlKXtcblx0XHRsZXQgZm9jdXNlZEluZGV4ID0gdGhpcy5mb2N1c2FibGVDaGlsZHJlbi5pbmRleE9mKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpO1xuXHRcdGlmKGUuc2hpZnRLZXkgJiYgZm9jdXNlZEluZGV4ID09PSAwKSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuW3RoaXMuZm9jdXNhYmxlQ2hpbGRyZW4ubGVuZ3RoIC0gMV0uZm9jdXMoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYoIWUuc2hpZnRLZXkgJiYgZm9jdXNlZEluZGV4ID09PSB0aGlzLmZvY3VzYWJsZUNoaWxkcmVuLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuWzBdLmZvY3VzKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9LFxuXHRrZXlMaXN0ZW5lcihlKXtcblx0XHRpZiAodGhpcy5pc09wZW4gJiYgZS5rZXlDb2RlID09PSAyNykge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0dGhpcy50b2dnbGUoKTtcblx0XHR9XG5cdFx0aWYgKHRoaXMuaXNPcGVuICYmIGUua2V5Q29kZSA9PT0gOSkgdGhpcy50cmFwVGFiKGUpO1xuXHR9LFxuXHRmb2N1c0luTGlzdGVuZXI6IGZ1bmN0aW9uKGUpe1xuXHRcdGlmKFxuXHRcdFx0IXRoaXMubm9kZS5jb250YWlucyhlLnRhcmdldCkgJiYgXG5cdFx0XHQhdGhpcy50b2dnbGVzLnJlZHVjZSgoYWNjLCB0b2dnbGUpID0+IHtcblx0XHRcdFx0aWYodG9nZ2xlID09PSBlLnRhcmdldCkgYWNjID0gdHJ1ZTtcblx0XHRcdFx0cmV0dXJuIGFjYztcblx0XHRcdH0sIGZhbHNlKVxuXHRcdCkgdGhpcy50b2dnbGUoKTtcblx0fSxcblx0bWFuYWdlQmx1ckNsb3NlOiBmdW5jdGlvbigpe1xuXHRcdGlmKCF0aGlzLmlzT3BlbikgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXNpbicsIHRoaXMuYm91bmRGb2N1c0luTGlzdGVuZXIpO1xuXHRcdGVsc2UgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXNpbicsIHRoaXMuYm91bmRGb2N1c0luTGlzdGVuZXIpO1xuXHR9LFxuXHR0b2dnbGU6IGZ1bmN0aW9uKGUpe1xuXHRcdGxldCBkZWxheSA9IHRoaXMuY2xhc3NUYXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMuc3RhdHVzQ2xhc3MpID8gIHRoaXMuc2V0dGluZ3MuZGVsYXkgOiAwO1xuXG5cdFx0KCEhdGhpcy5zZXR0aW5ncy5wcmVob29rICYmIHR5cGVvZiB0aGlzLnNldHRpbmdzLnByZWhvb2sgPT09ICdmdW5jdGlvbicpICYmIHRoaXMuc2V0dGluZ3MucHJlaG9vay5jYWxsKHRoaXMpO1xuXHRcdFxuXHRcdGlmKGUpIGUucHJldmVudERlZmF1bHQoKSwgZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcblx0XHR0aGlzLmNsYXNzVGFyZ2V0LmNsYXNzTGlzdC5hZGQodGhpcy5hbmltYXRpbmdDbGFzcyk7XG5cdFx0XG5cdFx0d2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0KCEhdGhpcy5zZXR0aW5ncy5mb2N1cyAmJiB0aGlzLmZvY3VzYWJsZUNoaWxkcmVuKSAmJiB0aGlzLm1hbmFnZUZvY3VzKCk7XG5cdFx0XHQhIXRoaXMuc2V0dGluZ3MuY2xvc2VPbkJsdXIgJiYgdGhpcy5tYW5hZ2VCbHVyQ2xvc2UoKTtcblx0XHRcdHRoaXMudG9nZ2xlQXR0cmlidXRlcygpO1xuXHRcdFx0dGhpcy50b2dnbGVTdGF0ZSgpO1xuXHRcdFx0KCEhdGhpcy5zZXR0aW5ncy5jYWxsYmFjayAmJiB0eXBlb2YgdGhpcy5zZXR0aW5ncy5jYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykgJiYgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5jYWxsKHRoaXMpO1xuXHRcdH0sIGRlbGF5KTtcblx0fVxufTsiLCJleHBvcnQgZGVmYXVsdCB7XG5cdGRlbGF5OiAwLFxuXHRzdGFydE9wZW46IGZhbHNlLFxuXHRsb2NhbDogZmFsc2UsXG5cdHByZWhvb2s6IGZhbHNlLFxuXHRjYWxsYmFjazogZmFsc2UsXG5cdGZvY3VzOiBmYWxzZSxcblx0dHJhcFRhYjogZmFsc2UsXG5cdGNsb3NlT25CbHVyOiBmYWxzZVxufTsiXX0=
