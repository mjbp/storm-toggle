(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
'use strict';

var _component = require('./libs/component');

var _component2 = _interopRequireDefault(_component);

function _interopRequireDefault(obj) {
	return obj && obj.__esModule ? obj : { default: obj };
}

var onDOMContentLoadedTasks = [function () {
	var toggle = _component2.default.init('.js-toggle', { closeOnBlur: true });
	var localToggle = _component2.default.init('.js-toggle__local', { local: true });
	console.log(toggle);
}];

if ('addEventListener' in window) window.addEventListener('DOMContentLoaded', function () {
	onDOMContentLoadedTasks.forEach(function (fn) {
		return fn();
	});
});

},{"./libs/component":2}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _defaults = require('./lib/defaults');

var _defaults2 = _interopRequireDefault(_defaults);

var _componentPrototype = require('./lib/component-prototype');

var _componentPrototype2 = _interopRequireDefault(_componentPrototype);

function _interopRequireDefault(obj) {
	return obj && obj.__esModule ? obj : { default: obj };
}

var init = function init(sel, opts) {
	var els = [].slice.call(document.querySelectorAll(sel));

	if (els.length === 0) throw new Error('Toggle cannot be initialised, no trigger elements found');

	return els.map(function (el) {
		return Object.assign(Object.create(_componentPrototype2.default), {
			node: el,
			settings: Object.assign({}, _defaults2.default, el.dataset, opts)
		}).init();
	});
};

exports.default = { init: init };

},{"./lib/component-prototype":3,"./lib/defaults":4}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
var TRIGGER_EVENTS = ['click', 'keydown'],
    TRIGGER_KEYCODES = [13, 32],
    FOCUSABLE_ELEMENTS = ['a[href]', 'area[href]', 'input:not([disabled])', 'select:not([disabled])', 'textarea:not([disabled])', 'button:not([disabled])', 'iframe', 'object', 'embed', '[contenteditable]', '[tabindex]:not([tabindex="-1"])'];

exports.default = {
	init: function init() {
		this.toggles = this.node.getAttribute('data-toggle') && [].slice.call(document.querySelectorAll('.' + this.node.getAttribute('data-toggle')));
		if (!this.toggles) return console.warn('Toggle cannot be initialised, no toggle buttons elements found'), false;

		this.isOpen = false;
		if (this.settings.focus) this.focusableChildren = this.getFocusableChildren();
		if (this.settings.trapTab) this.boundKeyListener = this.keyListener.bind(this);
		if (this.settings.closeOnBlur) this.boundFocusInListener = this.focusInListener.bind(this);
		this.classTarget = !this.settings.local ? document.documentElement : this.node.parentNode;
		this.statusClass = !this.settings.local ? 'on--' + this.node.getAttribute('id') : 'active';
		this.animatingClass = !this.settings.local ? 'animating--' + this.node.getAttribute('id') : 'animating';

		this.initToggles();
		this.settings.startOpen && this.toggle();

		return this;
	},
	initToggles: function initToggles() {
		var _this = this;

		this.toggles.forEach(function (toggle) {
			toggle.setAttribute('role', 'button');
			toggle.setAttribute('aria-controls', _this.node.getAttribute('id'));
			toggle.setAttribute('aria-expanded', 'false');
			TRIGGER_EVENTS.forEach(function (ev) {
				toggle.addEventListener(ev, function (e) {
					if (!!e.keyCode && !~TRIGGER_KEYCODES.indexOf(e.keyCode)) return;
					e.preventDefault();
					_this.toggle();
				});
			});
		});
	},
	getFocusableChildren: function getFocusableChildren() {
		return [].slice.call(this.node.querySelectorAll(FOCUSABLE_ELEMENTS.join(',')));
	},

	toggleState: function toggleState() {
		this.isOpen = !this.isOpen;
		this.toggles.forEach(function (toggle) {
			toggle.setAttribute('aria-expanded', toggle.getAttribute('aria-expanded') === 'true' ? 'false' : 'true');
		});
		this.classTarget.classList.remove(this.animatingClass);
		this.classTarget.classList.toggle(this.statusClass);
	},
	manageFocus: function manageFocus() {
		var _this2 = this;

		if (!this.isOpen) {
			this.lastFocused = document.activeElement;
			this.focusableChildren.length && window.setTimeout(function () {
				return _this2.focusableChildren[0].focus();
			}, this.settings.delay);
			this.settings.trapTab && document.addEventListener('keydown', this.boundKeyListener);
		} else {
			this.settings.trapTab && document.removeEventListener('keydown', this.boundKeyListener);
			this.focusableChildren.length && window.setTimeout(function () {
				_this2.lastFocused.focus();
				_this2.lastFocused = false;
			}, this.settings.delay);
		}
	},
	trapTab: function trapTab(e) {
		var focusedIndex = this.focusableChildren.indexOf(document.activeElement);
		if (e.shiftKey && focusedIndex === 0) {
			e.preventDefault();
			this.focusableChildren[this.focusableChildren.length - 1].focus();
		} else {
			if (!e.shiftKey && focusedIndex === this.focusableChildren.length - 1) {
				e.preventDefault();
				this.focusableChildren[0].focus();
			}
		}
	},
	keyListener: function keyListener(e) {
		if (this.isOpen && e.keyCode === 27) {
			e.preventDefault();
			this.toggle();
		}
		if (this.isOpen && e.keyCode === 9) this.trapTab(e);
	},

	focusInListener: function focusInListener(e) {
		if (!this.node.contains(e.target) && !this.toggles.reduce(function (acc, toggle) {
			if (toggle === e.target) acc = true;
			return acc;
		}, false)) this.toggle();
	},
	manageBlurClose: function manageBlurClose() {
		if (!this.isOpen) document.addEventListener('focusin', this.boundFocusInListener);else document.removeEventListener('focusin', this.boundFocusInListener);
	},
	toggle: function toggle(e) {
		var _this3 = this;

		var delay = this.classTarget.classList.contains(this.statusClass) ? this.settings.delay : 0;

		!!this.settings.prehook && typeof this.settings.prehook === 'function' && this.settings.prehook.call(this);

		if (e) e.preventDefault(), e.stopPropagation();

		this.classTarget.classList.add(this.animatingClass);

		window.setTimeout(function () {
			!!_this3.settings.focus && _this3.focusableChildren && _this3.manageFocus();
			!!_this3.settings.closeOnBlur && _this3.manageBlurClose();
			_this3.toggleState();
			!!_this3.settings.callback && typeof _this3.settings.callback === 'function' && _this3.settings.callback.call(_this3);
		}, delay);
	}
};

},{}],4:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.default = {
	delay: 0,
	startOpen: false,
	local: false,
	prehook: false,
	callback: false,
	focus: false,
	trapTab: false,
	closeOnBlur: false
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJleGFtcGxlL3NyYy9hcHAuanMiLCJleGFtcGxlL3NyYy9saWJzL2NvbXBvbmVudC9pbmRleC5qcyIsImV4YW1wbGUvc3JjL2xpYnMvY29tcG9uZW50L2xpYi9jb21wb25lbnQtcHJvdG90eXBlLmpzIiwiZXhhbXBsZS9zcmMvbGlicy9jb21wb25lbnQvbGliL2RlZmF1bHRzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxJQUFBLGFBQUEsUUFBQSxrQkFBQSxDQUFBOzs7Ozs7OztBQUVBLElBQU0sMEJBQTBCLENBQUMsWUFBTTtBQUN0QyxLQUFJLFNBQVMsWUFBQSxPQUFBLENBQUEsSUFBQSxDQUFBLFlBQUEsRUFBMEIsRUFBRSxhQUF6QyxJQUF1QyxFQUExQixDQUFiO0FBQ0EsS0FBSSxjQUFjLFlBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQSxtQkFBQSxFQUFpQyxFQUFFLE9BQXJELElBQW1ELEVBQWpDLENBQWxCO0FBQ0EsU0FBQSxHQUFBLENBQUEsTUFBQTtBQUhELENBQWdDLENBQWhDOztBQU1BLElBQUcsc0JBQUgsTUFBQSxFQUFpQyxPQUFBLGdCQUFBLENBQUEsa0JBQUEsRUFBNEMsWUFBTTtBQUFFLHlCQUFBLE9BQUEsQ0FBZ0MsVUFBQSxFQUFBLEVBQUE7QUFBQSxTQUFBLElBQUE7QUFBaEMsRUFBQTtBQUFwRCxDQUFBOzs7Ozs7Ozs7QUNSakMsSUFBQSxZQUFBLFFBQUEsZ0JBQUEsQ0FBQTs7OztBQUNBLElBQUEsc0JBQUEsUUFBQSwyQkFBQSxDQUFBOzs7Ozs7OztBQUVBLElBQU0sT0FBTyxTQUFQLElBQU8sQ0FBQSxHQUFBLEVBQUEsSUFBQSxFQUFlO0FBQzNCLEtBQUksTUFBTSxHQUFBLEtBQUEsQ0FBQSxJQUFBLENBQWMsU0FBQSxnQkFBQSxDQUF4QixHQUF3QixDQUFkLENBQVY7O0FBRUEsS0FBRyxJQUFBLE1BQUEsS0FBSCxDQUFBLEVBQXFC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T0FBckQsV0FBcUQsRUFBcEQ7QUFDRCxJQUFDLENBQUMsT0FBQSxRQUFBLENBQUYsV0FBQSxJQUErQixPQUEvQixlQUErQixFQUEvQjtBQUNBLFVBQUEsV0FBQTtBQUNDLElBQUMsQ0FBQyxPQUFBLFFBQUEsQ0FBRixRQUFBLElBQTRCLE9BQU8sT0FBQSxRQUFBLENBQVAsUUFBQSxLQUE3QixVQUFDLElBQTZFLE9BQUEsUUFBQSxDQUFBLFFBQUEsQ0FBQSxJQUFBLENBQTlFLE1BQThFLENBQTdFO0FBSkYsR0FBQSxFQUFBLEtBQUE7QUFNQTtBQXhHYSxDOzs7Ozs7OztrQkNKQTtBQUNkLFFBRGMsQ0FBQTtBQUVkLFlBRmMsS0FBQTtBQUdkLFFBSGMsS0FBQTtBQUlkLFVBSmMsS0FBQTtBQUtkLFdBTGMsS0FBQTtBQU1kLFFBTmMsS0FBQTtBQU9kLFVBUGMsS0FBQTtBQVFkLGNBQWE7QUFSQyxDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiaW1wb3J0IFRvZ2dsZSBmcm9tICcuL2xpYnMvY29tcG9uZW50JztcblxuY29uc3Qgb25ET01Db250ZW50TG9hZGVkVGFza3MgPSBbKCkgPT4ge1xuXHRsZXQgdG9nZ2xlID0gVG9nZ2xlLmluaXQoJy5qcy10b2dnbGUnLCB7IGNsb3NlT25CbHVyOiB0cnVlfSk7XG5cdGxldCBsb2NhbFRvZ2dsZSA9IFRvZ2dsZS5pbml0KCcuanMtdG9nZ2xlX19sb2NhbCcsIHsgbG9jYWw6IHRydWUgfSk7XG5cdGNvbnNvbGUubG9nKHRvZ2dsZSk7XG59XTtcbiAgICBcbmlmKCdhZGRFdmVudExpc3RlbmVyJyBpbiB3aW5kb3cpIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4geyBvbkRPTUNvbnRlbnRMb2FkZWRUYXNrcy5mb3JFYWNoKGZuID0+IGZuKCkpOyB9KTtcbiIsImltcG9ydCBkZWZhdWx0cyBmcm9tICcuL2xpYi9kZWZhdWx0cyc7XG5pbXBvcnQgY29tcG9uZW50UHJvdG90eXBlIGZyb20gJy4vbGliL2NvbXBvbmVudC1wcm90b3R5cGUnO1xuXG5jb25zdCBpbml0ID0gKHNlbCwgb3B0cykgPT4ge1xuXHRsZXQgZWxzID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbCkpO1xuXHRcblx0aWYoZWxzLmxlbmd0aCA9PT0gMCkgdGhyb3cgbmV3IEVycm9yKCdUb2dnbGUgY2Fubm90IGJlIGluaXRpYWxpc2VkLCBubyB0cmlnZ2VyIGVsZW1lbnRzIGZvdW5kJyk7XG5cdFxuXHRyZXR1cm4gZWxzLm1hcChlbCA9PiBPYmplY3QuYXNzaWduKE9iamVjdC5jcmVhdGUoY29tcG9uZW50UHJvdG90eXBlKSwge1xuXHRcdFx0bm9kZTogZWwsXG5cdFx0XHRzZXR0aW5nczogT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdHMsIGVsLmRhdGFzZXQsIG9wdHMpXG5cdFx0fSkuaW5pdCgpKTtcbn07XG4gICAgXG5leHBvcnQgZGVmYXVsdCB7IGluaXQgfTsiLCJjb25zdCBUUklHR0VSX0VWRU5UUyA9IFsnY2xpY2snLCAna2V5ZG93biddLFxuICAgICAgVFJJR0dFUl9LRVlDT0RFUyA9IFsxMywgMzJdLFxuXHQgIEZPQ1VTQUJMRV9FTEVNRU5UUyA9IFsnYVtocmVmXScsICdhcmVhW2hyZWZdJywgJ2lucHV0Om5vdChbZGlzYWJsZWRdKScsICdzZWxlY3Q6bm90KFtkaXNhYmxlZF0pJywgJ3RleHRhcmVhOm5vdChbZGlzYWJsZWRdKScsICdidXR0b246bm90KFtkaXNhYmxlZF0pJywgJ2lmcmFtZScsICdvYmplY3QnLCAnZW1iZWQnLCAnW2NvbnRlbnRlZGl0YWJsZV0nLCAnW3RhYmluZGV4XTpub3QoW3RhYmluZGV4PVwiLTFcIl0pJ107XG5cbmV4cG9ydCBkZWZhdWx0IHtcblx0aW5pdCgpIHtcblx0XHR0aGlzLnRvZ2dsZXMgPSB0aGlzLm5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLXRvZ2dsZScpICYmIFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyB0aGlzLm5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLXRvZ2dsZScpKSk7XG5cdFx0aWYoIXRoaXMudG9nZ2xlcykgcmV0dXJuIGNvbnNvbGUud2FybignVG9nZ2xlIGNhbm5vdCBiZSBpbml0aWFsaXNlZCwgbm8gdG9nZ2xlIGJ1dHRvbnMgZWxlbWVudHMgZm91bmQnKSwgZmFsc2U7XG5cdFx0XG5cdFx0dGhpcy5pc09wZW4gPSBmYWxzZTtcblx0XHRpZih0aGlzLnNldHRpbmdzLmZvY3VzKSB0aGlzLmZvY3VzYWJsZUNoaWxkcmVuID0gdGhpcy5nZXRGb2N1c2FibGVDaGlsZHJlbigpO1xuXHRcdGlmKHRoaXMuc2V0dGluZ3MudHJhcFRhYikgdGhpcy5ib3VuZEtleUxpc3RlbmVyID0gdGhpcy5rZXlMaXN0ZW5lci5iaW5kKHRoaXMpO1xuXHRcdGlmKHRoaXMuc2V0dGluZ3MuY2xvc2VPbkJsdXIpIHRoaXMuYm91bmRGb2N1c0luTGlzdGVuZXIgPSB0aGlzLmZvY3VzSW5MaXN0ZW5lci5iaW5kKHRoaXMpO1xuXHRcdHRoaXMuY2xhc3NUYXJnZXQgPSAoIXRoaXMuc2V0dGluZ3MubG9jYWwpID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50IDogdGhpcy5ub2RlLnBhcmVudE5vZGU7XG5cdFx0dGhpcy5zdGF0dXNDbGFzcyA9ICF0aGlzLnNldHRpbmdzLmxvY2FsID8gYG9uLS0ke3RoaXMubm9kZS5nZXRBdHRyaWJ1dGUoJ2lkJyl9YCA6ICdhY3RpdmUnO1xuXHRcdHRoaXMuYW5pbWF0aW5nQ2xhc3MgPSAhdGhpcy5zZXR0aW5ncy5sb2NhbCA/IGBhbmltYXRpbmctLSR7dGhpcy5ub2RlLmdldEF0dHJpYnV0ZSgnaWQnKX1gIDogJ2FuaW1hdGluZyc7XG5cblx0XHR0aGlzLmluaXRUb2dnbGVzKCk7XG5cdFx0dGhpcy5zZXR0aW5ncy5zdGFydE9wZW4gJiYgdGhpcy50b2dnbGUoKTtcblxuXHRcdHJldHVybiB0aGlzO1xuXHR9LFxuXHRpbml0VG9nZ2xlcygpIHtcblx0XHR0aGlzLnRvZ2dsZXMuZm9yRWFjaCh0b2dnbGUgPT4ge1xuXHRcdFx0dG9nZ2xlLnNldEF0dHJpYnV0ZSgncm9sZScsICdidXR0b24nKTtcblx0XHRcdHRvZ2dsZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnLCB0aGlzLm5vZGUuZ2V0QXR0cmlidXRlKCdpZCcpKTtcblx0XHRcdHRvZ2dsZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnKTtcblx0XHRcdFRSSUdHRVJfRVZFTlRTLmZvckVhY2goZXYgPT4ge1xuXHRcdFx0XHR0b2dnbGUuYWRkRXZlbnRMaXN0ZW5lcihldiwgZSA9PiB7XG5cdFx0XHRcdFx0aWYoISFlLmtleUNvZGUgJiYgIX5UUklHR0VSX0tFWUNPREVTLmluZGV4T2YoZS5rZXlDb2RlKSkgcmV0dXJuO1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHR0aGlzLnRvZ2dsZSgpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9LFxuXHRnZXRGb2N1c2FibGVDaGlsZHJlbigpIHtcblx0XHRyZXR1cm4gW10uc2xpY2UuY2FsbCh0aGlzLm5vZGUucXVlcnlTZWxlY3RvckFsbChGT0NVU0FCTEVfRUxFTUVOVFMuam9pbignLCcpKSk7XG5cdH0sXG5cdHRvZ2dsZVN0YXRlOiBmdW5jdGlvbigpe1xuXHRcdHRoaXMuaXNPcGVuID0gIXRoaXMuaXNPcGVuO1xuXHRcdHRoaXMudG9nZ2xlcy5mb3JFYWNoKHRvZ2dsZSA9PiB7XG5cdFx0XHR0b2dnbGUuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgdG9nZ2xlLmdldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcpID09PSAndHJ1ZScgPyAnZmFsc2UnIDogJ3RydWUnKTtcblx0XHR9KTtcblx0XHR0aGlzLmNsYXNzVGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5hbmltYXRpbmdDbGFzcyk7XG5cdFx0dGhpcy5jbGFzc1RhcmdldC5jbGFzc0xpc3QudG9nZ2xlKHRoaXMuc3RhdHVzQ2xhc3MpO1xuXHR9LFxuXHRtYW5hZ2VGb2N1czogZnVuY3Rpb24oKXtcblx0XHRpZighdGhpcy5pc09wZW4pe1xuXHRcdFx0dGhpcy5sYXN0Rm9jdXNlZCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG5cdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuLmxlbmd0aCAmJiB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB0aGlzLmZvY3VzYWJsZUNoaWxkcmVuWzBdLmZvY3VzKCksIHRoaXMuc2V0dGluZ3MuZGVsYXkpO1xuXHRcdFx0dGhpcy5zZXR0aW5ncy50cmFwVGFiICYmIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmJvdW5kS2V5TGlzdGVuZXIpO1xuXHRcdH1cblx0XHRlbHNlIHtcblx0XHRcdHRoaXMuc2V0dGluZ3MudHJhcFRhYiAmJiBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5ib3VuZEtleUxpc3RlbmVyKTtcblx0XHRcdHRoaXMuZm9jdXNhYmxlQ2hpbGRyZW4ubGVuZ3RoICYmIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0dGhpcy5sYXN0Rm9jdXNlZC5mb2N1cygpO1xuXHRcdFx0XHR0aGlzLmxhc3RGb2N1c2VkID0gZmFsc2U7XG5cdFx0XHR9LCB0aGlzLnNldHRpbmdzLmRlbGF5KTtcblx0XHR9XG5cdH0sXG5cdHRyYXBUYWI6IGZ1bmN0aW9uKGUpe1xuXHRcdGxldCBmb2N1c2VkSW5kZXggPSB0aGlzLmZvY3VzYWJsZUNoaWxkcmVuLmluZGV4T2YoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCk7XG5cdFx0aWYoZS5zaGlmdEtleSAmJiBmb2N1c2VkSW5kZXggPT09IDApIHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdHRoaXMuZm9jdXNhYmxlQ2hpbGRyZW5bdGhpcy5mb2N1c2FibGVDaGlsZHJlbi5sZW5ndGggLSAxXS5mb2N1cygpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZighZS5zaGlmdEtleSAmJiBmb2N1c2VkSW5kZXggPT09IHRoaXMuZm9jdXNhYmxlQ2hpbGRyZW4ubGVuZ3RoIC0gMSkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdHRoaXMuZm9jdXNhYmxlQ2hpbGRyZW5bMF0uZm9jdXMoKTtcblx0XHRcdH1cblx0XHR9XG5cdH0sXG5cdGtleUxpc3RlbmVyKGUpe1xuXHRcdGlmICh0aGlzLmlzT3BlbiAmJiBlLmtleUNvZGUgPT09IDI3KSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR0aGlzLnRvZ2dsZSgpO1xuXHRcdH1cblx0XHRpZiAodGhpcy5pc09wZW4gJiYgZS5rZXlDb2RlID09PSA5KSB0aGlzLnRyYXBUYWIoZSk7XG5cdH0sXG5cdGZvY3VzSW5MaXN0ZW5lcjogZnVuY3Rpb24oZSl7XG5cdFx0aWYoXG5cdFx0XHQhdGhpcy5ub2RlLmNvbnRhaW5zKGUudGFyZ2V0KSAmJiBcblx0XHRcdCF0aGlzLnRvZ2dsZXMucmVkdWNlKChhY2MsIHRvZ2dsZSkgPT4ge1xuXHRcdFx0XHRpZih0b2dnbGUgPT09IGUudGFyZ2V0KSBhY2MgPSB0cnVlO1xuXHRcdFx0XHRyZXR1cm4gYWNjO1xuXHRcdFx0fSwgZmFsc2UpXG5cdFx0KSB0aGlzLnRvZ2dsZSgpO1xuXHR9LFxuXHRtYW5hZ2VCbHVyQ2xvc2U6IGZ1bmN0aW9uKCl7XG5cdFx0aWYoIXRoaXMuaXNPcGVuKSBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1c2luJywgdGhpcy5ib3VuZEZvY3VzSW5MaXN0ZW5lcik7XG5cdFx0ZWxzZSBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1c2luJywgdGhpcy5ib3VuZEZvY3VzSW5MaXN0ZW5lcik7XG5cdH0sXG5cdHRvZ2dsZTogZnVuY3Rpb24oZSl7XG5cdFx0bGV0IGRlbGF5ID0gdGhpcy5jbGFzc1RhcmdldC5jbGFzc0xpc3QuY29udGFpbnModGhpcy5zdGF0dXNDbGFzcykgPyAgdGhpcy5zZXR0aW5ncy5kZWxheSA6IDA7XG5cblx0XHQoISF0aGlzLnNldHRpbmdzLnByZWhvb2sgJiYgdHlwZW9mIHRoaXMuc2V0dGluZ3MucHJlaG9vayA9PT0gJ2Z1bmN0aW9uJykgJiYgdGhpcy5zZXR0aW5ncy5wcmVob29rLmNhbGwodGhpcyk7XG5cdFx0XG5cdFx0aWYoZSkgZS5wcmV2ZW50RGVmYXVsdCgpLCBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFxuXHRcdHRoaXMuY2xhc3NUYXJnZXQuY2xhc3NMaXN0LmFkZCh0aGlzLmFuaW1hdGluZ0NsYXNzKTtcblx0XHRcblx0XHR3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHQoISF0aGlzLnNldHRpbmdzLmZvY3VzICYmIHRoaXMuZm9jdXNhYmxlQ2hpbGRyZW4pICYmIHRoaXMubWFuYWdlRm9jdXMoKTtcblx0XHRcdCEhdGhpcy5zZXR0aW5ncy5jbG9zZU9uQmx1ciAmJiB0aGlzLm1hbmFnZUJsdXJDbG9zZSgpO1xuXHRcdFx0dGhpcy50b2dnbGVTdGF0ZSgpO1xuXHRcdFx0KCEhdGhpcy5zZXR0aW5ncy5jYWxsYmFjayAmJiB0eXBlb2YgdGhpcy5zZXR0aW5ncy5jYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykgJiYgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5jYWxsKHRoaXMpO1xuXHRcdH0sIGRlbGF5KTtcblx0fVxufTsiLCJleHBvcnQgZGVmYXVsdCB7XG5cdGRlbGF5OiAwLFxuXHRzdGFydE9wZW46IGZhbHNlLFxuXHRsb2NhbDogZmFsc2UsXG5cdHByZWhvb2s6IGZhbHNlLFxuXHRjYWxsYmFjazogZmFsc2UsXG5cdGZvY3VzOiBmYWxzZSxcblx0dHJhcFRhYjogZmFsc2UsXG5cdGNsb3NlT25CbHVyOiBmYWxzZVxufTsiXX0=
