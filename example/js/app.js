(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
'use strict';

var _component = require('./libs/component');

var _component2 = _interopRequireDefault(_component);

function _interopRequireDefault(obj) {
	return obj && obj.__esModule ? obj : { default: obj };
}

var onDOMContentLoadedTasks = [function () {
	var toggle = _component2.default.init('.js-toggle', { closeOnBlur: true });
	var localToggle = _component2.default.init('.js-toggle__local', { local: true });
	console.log(toggle);
}];

if ('addEventListener' in window) window.addEventListener('DOMContentLoaded', function () {
	onDOMContentLoadedTasks.forEach(function (fn) {
		return fn();
	});
});

},{"./libs/component":2}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _defaults = require('./lib/defaults');

var _defaults2 = _interopRequireDefault(_defaults);

var _componentPrototype = require('./lib/component-prototype');

var _componentPrototype2 = _interopRequireDefault(_componentPrototype);

function _interopRequireDefault(obj) {
	return obj && obj.__esModule ? obj : { default: obj };
}

var init = function init(sel, opts) {
	var els = [].slice.call(document.querySelectorAll(sel));

	if (els.length === 0) throw new Error('Toggle cannot be initialised, no trigger elements found');

	return els.map(function (el) {
		return Object.assign(Object.create(_componentPrototype2.default), {
			node: el,
			settings: Object.assign({}, _defaults2.default, el.dataset, opts)
		}).init();
	});
};

exports.default = { init: init };

},{"./lib/component-prototype":3,"./lib/defaults":4}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
var TRIGGER_EVENTS = ['click', 'keydown'],
    TRIGGER_KEYCODES = [13, 32],
    FOCUSABLE_ELEMENTS = ['a[href]', 'area[href]', 'input:not([disabled])', 'select:not([disabled])', 'textarea:not([disabled])', 'button:not([disabled])', 'iframe', 'object', 'embed', '[contenteditable]', '[tabindex]:not([tabindex="-1"])'];

exports.default = {
	init: function init() {
		this.toggles = this.node.getAttribute('data-toggle') && [].slice.call(document.querySelectorAll('.' + this.node.getAttribute('data-toggle')));
		if (!this.toggles) return console.warn('Toggle cannot be initialised, no toggle buttons elements found'), false;

		this.isOpen = false;
		if (this.settings.focus) this.focusableChildren = this.getFocusableChildren();
		if (this.settings.trapTab) this.boundKeyListener = this.keyListener.bind(this);
		if (this.settings.closeOnBlur) this.boundFocusInListener = this.focusInListener.bind(this);
		this.classTarget = !this.settings.local ? document.documentElement : this.node.parentNode;
		this.statusClass = !this.settings.local ? 'on--' + this.node.getAttribute('id') : 'active';
		this.animatingClass = !this.settings.local ? 'animating--' + this.node.getAttribute('id') : 'animating';

		this.initToggles();
		this.settings.startOpen && this.toggle();

		return this;
	},
	initToggles: function initToggles() {
		var _this = this;

		this.toggles.forEach(function (toggle) {
			if (toggle.tagName !== 'BUTTON') toggle.setAttribute('role', 'button');
			toggle.setAttribute('aria-controls', _this.node.getAttribute('id'));
			toggle.setAttribute('aria-expanded', 'false');
			TRIGGER_EVENTS.forEach(function (ev) {
				toggle.addEventListener(ev, function (e) {
					if (!!e.keyCode && !~TRIGGER_KEYCODES.indexOf(e.keyCode)) return;
					e.preventDefault();
					_this.toggle();
				});
			});
		});
	},
	getFocusableChildren: function getFocusableChildren() {
		return [].slice.call(this.node.querySelectorAll(FOCUSABLE_ELEMENTS.join(',')));
	},

	toggleState: function toggleState() {
		this.isOpen = !this.isOpen;
		this.toggles.forEach(function (toggle) {
			toggle.setAttribute('aria-expanded', toggle.getAttribute('aria-expanded') === 'true' ? 'false' : 'true');
		});
		this.classTarget.classList.remove(this.animatingClass);
		this.classTarget.classList.toggle(this.statusClass);
	},
	manageFocus: function manageFocus() {
		var _this2 = this;

		if (!this.isOpen) {
			this.lastFocused = document.activeElement;
			this.focusableChildren.length && window.setTimeout(function () {
				return _this2.focusableChildren[0].focus();
			}, this.settings.delay);
			this.settings.trapTab && document.addEventListener('keydown', this.boundKeyListener);
		} else {
			this.settings.trapTab && document.removeEventListener('keydown', this.boundKeyListener);
			this.focusableChildren.length && window.setTimeout(function () {
				_this2.lastFocused.focus();
				_this2.lastFocused = false;
			}, this.settings.delay);
		}
	},
	trapTab: function trapTab(e) {
		var focusedIndex = this.focusableChildren.indexOf(document.activeElement);
		if (e.shiftKey && focusedIndex === 0) {
			e.preventDefault();
			this.focusableChildren[this.focusableChildren.length - 1].focus();
		} else {
			if (!e.shiftKey && focusedIndex === this.focusableChildren.length - 1) {
				e.preventDefault();
				this.focusableChildren[0].focus();
			}
		}
	},
	keyListener: function keyListener(e) {
		if (this.isOpen && e.keyCode === 27) {
			e.preventDefault();
			this.toggle();
		}
		if (this.isOpen && e.keyCode === 9) this.trapTab(e);
	},

	focusInListener: function focusInListener(e) {
		if (!this.node.contains(e.target) && !this.toggles.reduce(function (acc, toggle) {
			if (toggle === e.target) acc = true;
			return acc;
		}, false)) this.toggle();
	},
	manageBlurClose: function manageBlurClose() {
		if (!this.isOpen) document.addEventListener('focusin', this.boundFocusInListener);else document.removeEventListener('focusin', this.boundFocusInListener);
	},
	toggle: function toggle(e) {
		var _this3 = this;

		var delay = this.classTarget.classList.contains(this.statusClass) ? this.settings.delay : 0;

		!!this.settings.prehook && typeof this.settings.prehook === 'function' && this.settings.prehook.call(this);

		if (e) e.preventDefault(), e.stopPropagation();

		this.classTarget.classList.add(this.animatingClass);

		window.setTimeout(function () {
			!!_this3.settings.focus && _this3.focusableChildren && _this3.manageFocus();
			!!_this3.settings.closeOnBlur && _this3.manageBlurClose();
			_this3.toggleState();
			!!_this3.settings.callback && typeof _this3.settings.callback === 'function' && _this3.settings.callback.call(_this3);
		}, delay);
	}
};

},{}],4:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.default = {
	delay: 0,
	startOpen: false,
	local: false,
	prehook: false,
	callback: false,
	focus: false,
	trapTab: false,
	closeOnBlur: false
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJleGFtcGxlL3NyYy9hcHAuanMiLCJleGFtcGxlL3NyYy9saWJzL2NvbXBvbmVudC9pbmRleC5qcyIsImV4YW1wbGUvc3JjL2xpYnMvY29tcG9uZW50L2xpYi9jb21wb25lbnQtcHJvdG90eXBlLmpzIiwiZXhhbXBsZS9zcmMvbGlicy9jb21wb25lbnQvbGliL2RlZmF1bHRzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxJQUFBLGFBQUEsUUFBQSxrQkFBQSxDQUFBOzs7Ozs7OztBQUVBLElBQU0sMEJBQTBCLENBQUMsWUFBTTtBQUN0QyxLQUFJLFNBQVMsWUFBQSxPQUFBLENBQUEsSUFBQSxDQUFBLFlBQUEsRUFBMEIsRUFBRSxhQUF6QyxJQUF1QyxFQUExQixDQUFiO0FBQ0EsS0FBSSxjQUFjLFlBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQSxtQkFBQSxFQUFpQyxFQUFFLE9BQXJELElBQW1ELEVBQWpDLENBQWxCO0FBQ0EsU0FBQSxHQUFBLENBQUEsTUFBQTtBQUhELENBQWdDLENBQWhDOztBQU1BLElBQUcsc0JBQUgsTUFBQSxFQUFpQyxPQUFBLGdCQUFBLENBQUEsa0JBQUEsRUFBNEMsWUFBTTtBQUFFLHlCQUFBLE9BQUEsQ0FBZ0MsVUFBQSxFQUFBLEVBQUE7QUFBQSxTQUFBLElBQUE7QUFBaEMsRUFBQTtBQUFwRCxDQUFBOzs7Ozs7Ozs7QUNSakMsSUFBQSxZQUFBLFFBQUEsZ0JBQUEsQ0FBQTs7OztBQUNBLElBQUEsc0JBQUEsUUFBQSwyQkFBQSxDQUFBOzs7Ozs7OztBQUVBLElBQU0sT0FBTyxTQUFQLElBQU8sQ0FBQSxHQUFBLEVBQUEsSUFBQSxFQUFlO0FBQzNCLEtBQUksTUFBTSxHQUFBLEtBQUEsQ0FBQSxJQUFBLENBQWMsU0FBQSxnQkFBQSxDQUF4QixHQUF3QixDQUFkLENBQVY7O0FBRUEsS0FBRyxJQUFBLE1BQUEsS0FBSCxDQUFBLEVBQXFC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QUYsS0FBQSxJQUF5QixPQUExQixpQkFBQyxJQUFvRCxPQUFyRCxXQUFxRCxFQUFwRDtBQUNELElBQUMsQ0FBQyxPQUFBLFFBQUEsQ0FBRixXQUFBLElBQStCLE9BQS9CLGVBQStCLEVBQS9CO0FBQ0EsVUFBQSxXQUFBO0FBQ0MsSUFBQyxDQUFDLE9BQUEsUUFBQSxDQUFGLFFBQUEsSUFBNEIsT0FBTyxPQUFBLFFBQUEsQ0FBUCxRQUFBLEtBQTdCLFVBQUMsSUFBNkUsT0FBQSxRQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsQ0FBOUUsTUFBOEUsQ0FBN0U7QUFKRixHQUFBLEVBQUEsS0FBQTtBQU1BO0FBeEdhLEM7Ozs7Ozs7O2tCQ0pBO0FBQ2QsUUFEYyxDQUFBO0FBRWQsWUFGYyxLQUFBO0FBR2QsUUFIYyxLQUFBO0FBSWQsVUFKYyxLQUFBO0FBS2QsV0FMYyxLQUFBO0FBTWQsUUFOYyxLQUFBO0FBT2QsVUFQYyxLQUFBO0FBUWQsY0FBYTtBQVJDLEMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJpbXBvcnQgVG9nZ2xlIGZyb20gJy4vbGlicy9jb21wb25lbnQnO1xuXG5jb25zdCBvbkRPTUNvbnRlbnRMb2FkZWRUYXNrcyA9IFsoKSA9PiB7XG5cdGxldCB0b2dnbGUgPSBUb2dnbGUuaW5pdCgnLmpzLXRvZ2dsZScsIHsgY2xvc2VPbkJsdXI6IHRydWV9KTtcblx0bGV0IGxvY2FsVG9nZ2xlID0gVG9nZ2xlLmluaXQoJy5qcy10b2dnbGVfX2xvY2FsJywgeyBsb2NhbDogdHJ1ZSB9KTtcblx0Y29uc29sZS5sb2codG9nZ2xlKTtcbn1dO1xuICAgIFxuaWYoJ2FkZEV2ZW50TGlzdGVuZXInIGluIHdpbmRvdykgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7IG9uRE9NQ29udGVudExvYWRlZFRhc2tzLmZvckVhY2goZm4gPT4gZm4oKSk7IH0pO1xuIiwiaW1wb3J0IGRlZmF1bHRzIGZyb20gJy4vbGliL2RlZmF1bHRzJztcbmltcG9ydCBjb21wb25lbnRQcm90b3R5cGUgZnJvbSAnLi9saWIvY29tcG9uZW50LXByb3RvdHlwZSc7XG5cbmNvbnN0IGluaXQgPSAoc2VsLCBvcHRzKSA9PiB7XG5cdGxldCBlbHMgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsKSk7XG5cdFxuXHRpZihlbHMubGVuZ3RoID09PSAwKSB0aHJvdyBuZXcgRXJyb3IoJ1RvZ2dsZSBjYW5ub3QgYmUgaW5pdGlhbGlzZWQsIG5vIHRyaWdnZXIgZWxlbWVudHMgZm91bmQnKTtcblx0XG5cdHJldHVybiBlbHMubWFwKGVsID0+IE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShjb21wb25lbnRQcm90b3R5cGUpLCB7XG5cdFx0XHRub2RlOiBlbCxcblx0XHRcdHNldHRpbmdzOiBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0cywgZWwuZGF0YXNldCwgb3B0cylcblx0XHR9KS5pbml0KCkpO1xufTtcbiAgICBcbmV4cG9ydCBkZWZhdWx0IHsgaW5pdCB9OyIsImNvbnN0IFRSSUdHRVJfRVZFTlRTID0gWydjbGljaycsICdrZXlkb3duJ10sXG4gICAgICBUUklHR0VSX0tFWUNPREVTID0gWzEzLCAzMl0sXG5cdCAgRk9DVVNBQkxFX0VMRU1FTlRTID0gWydhW2hyZWZdJywgJ2FyZWFbaHJlZl0nLCAnaW5wdXQ6bm90KFtkaXNhYmxlZF0pJywgJ3NlbGVjdDpub3QoW2Rpc2FibGVkXSknLCAndGV4dGFyZWE6bm90KFtkaXNhYmxlZF0pJywgJ2J1dHRvbjpub3QoW2Rpc2FibGVkXSknLCAnaWZyYW1lJywgJ29iamVjdCcsICdlbWJlZCcsICdbY29udGVudGVkaXRhYmxlXScsICdbdGFiaW5kZXhdOm5vdChbdGFiaW5kZXg9XCItMVwiXSknXTtcblxuZXhwb3J0IGRlZmF1bHQge1xuXHRpbml0KCkge1xuXHRcdHRoaXMudG9nZ2xlcyA9IHRoaXMubm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlJykgJiYgW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIHRoaXMubm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlJykpKTtcblx0XHRpZighdGhpcy50b2dnbGVzKSByZXR1cm4gY29uc29sZS53YXJuKCdUb2dnbGUgY2Fubm90IGJlIGluaXRpYWxpc2VkLCBubyB0b2dnbGUgYnV0dG9ucyBlbGVtZW50cyBmb3VuZCcpLCBmYWxzZTtcblx0XHRcblx0XHR0aGlzLmlzT3BlbiA9IGZhbHNlO1xuXHRcdGlmKHRoaXMuc2V0dGluZ3MuZm9jdXMpIHRoaXMuZm9jdXNhYmxlQ2hpbGRyZW4gPSB0aGlzLmdldEZvY3VzYWJsZUNoaWxkcmVuKCk7XG5cdFx0aWYodGhpcy5zZXR0aW5ncy50cmFwVGFiKSB0aGlzLmJvdW5kS2V5TGlzdGVuZXIgPSB0aGlzLmtleUxpc3RlbmVyLmJpbmQodGhpcyk7XG5cdFx0aWYodGhpcy5zZXR0aW5ncy5jbG9zZU9uQmx1cikgdGhpcy5ib3VuZEZvY3VzSW5MaXN0ZW5lciA9IHRoaXMuZm9jdXNJbkxpc3RlbmVyLmJpbmQodGhpcyk7XG5cdFx0dGhpcy5jbGFzc1RhcmdldCA9ICghdGhpcy5zZXR0aW5ncy5sb2NhbCkgPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgOiB0aGlzLm5vZGUucGFyZW50Tm9kZTtcblx0XHR0aGlzLnN0YXR1c0NsYXNzID0gIXRoaXMuc2V0dGluZ3MubG9jYWwgPyBgb24tLSR7dGhpcy5ub2RlLmdldEF0dHJpYnV0ZSgnaWQnKX1gIDogJ2FjdGl2ZSc7XG5cdFx0dGhpcy5hbmltYXRpbmdDbGFzcyA9ICF0aGlzLnNldHRpbmdzLmxvY2FsID8gYGFuaW1hdGluZy0tJHt0aGlzLm5vZGUuZ2V0QXR0cmlidXRlKCdpZCcpfWAgOiAnYW5pbWF0aW5nJztcblxuXHRcdHRoaXMuaW5pdFRvZ2dsZXMoKTtcblx0XHR0aGlzLnNldHRpbmdzLnN0YXJ0T3BlbiAmJiB0aGlzLnRvZ2dsZSgpO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH0sXG5cdGluaXRUb2dnbGVzKCkge1xuXHRcdHRoaXMudG9nZ2xlcy5mb3JFYWNoKHRvZ2dsZSA9PiB7XG5cdFx0XHRpZih0b2dnbGUudGFnTmFtZSAhPT0gJ0JVVFRPTicpIHRvZ2dsZS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XG5cdFx0XHR0b2dnbGUuc2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJywgdGhpcy5ub2RlLmdldEF0dHJpYnV0ZSgnaWQnKSk7XG5cdFx0XHR0b2dnbGUuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyk7XG5cdFx0XHRUUklHR0VSX0VWRU5UUy5mb3JFYWNoKGV2ID0+IHtcblx0XHRcdFx0dG9nZ2xlLmFkZEV2ZW50TGlzdGVuZXIoZXYsIGUgPT4ge1xuXHRcdFx0XHRcdGlmKCEhZS5rZXlDb2RlICYmICF+VFJJR0dFUl9LRVlDT0RFUy5pbmRleE9mKGUua2V5Q29kZSkpIHJldHVybjtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0dGhpcy50b2dnbGUoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fSxcblx0Z2V0Rm9jdXNhYmxlQ2hpbGRyZW4oKSB7XG5cdFx0cmV0dXJuIFtdLnNsaWNlLmNhbGwodGhpcy5ub2RlLnF1ZXJ5U2VsZWN0b3JBbGwoRk9DVVNBQkxFX0VMRU1FTlRTLmpvaW4oJywnKSkpO1xuXHR9LFxuXHR0b2dnbGVTdGF0ZTogZnVuY3Rpb24oKXtcblx0XHR0aGlzLmlzT3BlbiA9ICF0aGlzLmlzT3Blbjtcblx0XHR0aGlzLnRvZ2dsZXMuZm9yRWFjaCh0b2dnbGUgPT4ge1xuXHRcdFx0dG9nZ2xlLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsIHRvZ2dsZS5nZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnKSA9PT0gJ3RydWUnID8gJ2ZhbHNlJyA6ICd0cnVlJyk7XG5cdFx0fSk7XG5cdFx0dGhpcy5jbGFzc1RhcmdldC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuYW5pbWF0aW5nQ2xhc3MpO1xuXHRcdHRoaXMuY2xhc3NUYXJnZXQuY2xhc3NMaXN0LnRvZ2dsZSh0aGlzLnN0YXR1c0NsYXNzKTtcblx0fSxcblx0bWFuYWdlRm9jdXM6IGZ1bmN0aW9uKCl7XG5cdFx0aWYoIXRoaXMuaXNPcGVuKXtcblx0XHRcdHRoaXMubGFzdEZvY3VzZWQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuXHRcdFx0dGhpcy5mb2N1c2FibGVDaGlsZHJlbi5sZW5ndGggJiYgd2luZG93LnNldFRpbWVvdXQoKCkgPT4gdGhpcy5mb2N1c2FibGVDaGlsZHJlblswXS5mb2N1cygpLCB0aGlzLnNldHRpbmdzLmRlbGF5KTtcblx0XHRcdHRoaXMuc2V0dGluZ3MudHJhcFRhYiAmJiBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5ib3VuZEtleUxpc3RlbmVyKTtcblx0XHR9XG5cdFx0ZWxzZSB7XG5cdFx0XHR0aGlzLnNldHRpbmdzLnRyYXBUYWIgJiYgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuYm91bmRLZXlMaXN0ZW5lcik7XG5cdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuLmxlbmd0aCAmJiB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdHRoaXMubGFzdEZvY3VzZWQuZm9jdXMoKTtcblx0XHRcdFx0dGhpcy5sYXN0Rm9jdXNlZCA9IGZhbHNlO1xuXHRcdFx0fSwgdGhpcy5zZXR0aW5ncy5kZWxheSk7XG5cdFx0fVxuXHR9LFxuXHR0cmFwVGFiOiBmdW5jdGlvbihlKXtcblx0XHRsZXQgZm9jdXNlZEluZGV4ID0gdGhpcy5mb2N1c2FibGVDaGlsZHJlbi5pbmRleE9mKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpO1xuXHRcdGlmKGUuc2hpZnRLZXkgJiYgZm9jdXNlZEluZGV4ID09PSAwKSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuW3RoaXMuZm9jdXNhYmxlQ2hpbGRyZW4ubGVuZ3RoIC0gMV0uZm9jdXMoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYoIWUuc2hpZnRLZXkgJiYgZm9jdXNlZEluZGV4ID09PSB0aGlzLmZvY3VzYWJsZUNoaWxkcmVuLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuWzBdLmZvY3VzKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9LFxuXHRrZXlMaXN0ZW5lcihlKXtcblx0XHRpZiAodGhpcy5pc09wZW4gJiYgZS5rZXlDb2RlID09PSAyNykge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0dGhpcy50b2dnbGUoKTtcblx0XHR9XG5cdFx0aWYgKHRoaXMuaXNPcGVuICYmIGUua2V5Q29kZSA9PT0gOSkgdGhpcy50cmFwVGFiKGUpO1xuXHR9LFxuXHRmb2N1c0luTGlzdGVuZXI6IGZ1bmN0aW9uKGUpe1xuXHRcdGlmKFxuXHRcdFx0IXRoaXMubm9kZS5jb250YWlucyhlLnRhcmdldCkgJiYgXG5cdFx0XHQhdGhpcy50b2dnbGVzLnJlZHVjZSgoYWNjLCB0b2dnbGUpID0+IHtcblx0XHRcdFx0aWYodG9nZ2xlID09PSBlLnRhcmdldCkgYWNjID0gdHJ1ZTtcblx0XHRcdFx0cmV0dXJuIGFjYztcblx0XHRcdH0sIGZhbHNlKVxuXHRcdCkgdGhpcy50b2dnbGUoKTtcblx0fSxcblx0bWFuYWdlQmx1ckNsb3NlOiBmdW5jdGlvbigpe1xuXHRcdGlmKCF0aGlzLmlzT3BlbikgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXNpbicsIHRoaXMuYm91bmRGb2N1c0luTGlzdGVuZXIpO1xuXHRcdGVsc2UgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXNpbicsIHRoaXMuYm91bmRGb2N1c0luTGlzdGVuZXIpO1xuXHR9LFxuXHR0b2dnbGU6IGZ1bmN0aW9uKGUpe1xuXHRcdGxldCBkZWxheSA9IHRoaXMuY2xhc3NUYXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMuc3RhdHVzQ2xhc3MpID8gIHRoaXMuc2V0dGluZ3MuZGVsYXkgOiAwO1xuXG5cdFx0KCEhdGhpcy5zZXR0aW5ncy5wcmVob29rICYmIHR5cGVvZiB0aGlzLnNldHRpbmdzLnByZWhvb2sgPT09ICdmdW5jdGlvbicpICYmIHRoaXMuc2V0dGluZ3MucHJlaG9vay5jYWxsKHRoaXMpO1xuXHRcdFxuXHRcdGlmKGUpIGUucHJldmVudERlZmF1bHQoKSwgZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcblx0XHR0aGlzLmNsYXNzVGFyZ2V0LmNsYXNzTGlzdC5hZGQodGhpcy5hbmltYXRpbmdDbGFzcyk7XG5cdFx0XG5cdFx0d2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0KCEhdGhpcy5zZXR0aW5ncy5mb2N1cyAmJiB0aGlzLmZvY3VzYWJsZUNoaWxkcmVuKSAmJiB0aGlzLm1hbmFnZUZvY3VzKCk7XG5cdFx0XHQhIXRoaXMuc2V0dGluZ3MuY2xvc2VPbkJsdXIgJiYgdGhpcy5tYW5hZ2VCbHVyQ2xvc2UoKTtcblx0XHRcdHRoaXMudG9nZ2xlU3RhdGUoKTtcblx0XHRcdCghIXRoaXMuc2V0dGluZ3MuY2FsbGJhY2sgJiYgdHlwZW9mIHRoaXMuc2V0dGluZ3MuY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpICYmIHRoaXMuc2V0dGluZ3MuY2FsbGJhY2suY2FsbCh0aGlzKTtcblx0XHR9LCBkZWxheSk7XG5cdH1cbn07IiwiZXhwb3J0IGRlZmF1bHQge1xuXHRkZWxheTogMCxcblx0c3RhcnRPcGVuOiBmYWxzZSxcblx0bG9jYWw6IGZhbHNlLFxuXHRwcmVob29rOiBmYWxzZSxcblx0Y2FsbGJhY2s6IGZhbHNlLFxuXHRmb2N1czogZmFsc2UsXG5cdHRyYXBUYWI6IGZhbHNlLFxuXHRjbG9zZU9uQmx1cjogZmFsc2Vcbn07Il19
